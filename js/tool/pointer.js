define(["knockout","underscore","draw","text!view/pointer.svg","points"],function(n,e,t,i,a){var o=n.observable(),r=n.observable(),s=function(n){o(t.fromView(n.start))},c=function(n){r(t.fromView(n.position))},u=function(){o(null),r(null)},l=function(){if(o()&&r()){var n=Math.min(o().x,r().x),i=Math.min(o().y,r().y),s=Math.max(o().x,r().x),c=Math.max(o().y,r().y),l=function(e){return e.x>=n&&e.x<=s&&e.y>=i&&e.y<=c},h=[];e(t.layers()).each(function(n){n.visible()&&e(n.shapes()).each(function(n){var t=a(n);n.visible()&&t.length>0&&e(t).all(l)&&h.push(n)})}),t.selection(h)}u()};return{name:"Rectangle",iconView:'<span class="draw-icon-pointer"></span>',view:i,rect:n.computed(function(){if(o()&&r())return t.toView({x:Math.min(o().x,r().x),y:Math.min(o().y,r().y),width:Math.abs(o().x-r().x),height:Math.abs(o().y-r().y)})}),dragstart:s,drag:c,release:l,close:u}});