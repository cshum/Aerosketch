define(["knockout","draw","text!view/ratio.html"],function(o,r,e){function n(o){var e=r.fromView(o.start);i=r.layer().newShape(c()?"circle":"ellipse"),i.set(r.options),i.cx(e.x),i.cy(e.y)}function a(o){var e=r.fromView(o.start),n=r.fromView(o.position);if(c())i.r(r.round(o.distance/r.zoom()/2)),i.cx(r.round((e.x+n.x)/2)),i.cy(r.round((e.y+n.y)/2));else{var a=o.distanceX/r.zoom()/2,t=o.distanceY/r.zoom()/2;i.rx(r.round(Math.abs(a))),i.ry(r.round(Math.abs(t))),i.cx(r.round(e.x+a)),i.cy(r.round(e.y+t))}}function t(){i&&r.save(i),i=null}var i,c=o.observable(!1);return{name:"Ellipse",iconView:'<span class="draw-icon-circle"></span>',toolbarView:e,dragstart:n,drag:a,release:t,off:t,lock:c,toggleLock:function(){c(!c())}}});