define(["knockout","draw","text!view/ratio.html"],function(a,t,e){function n(a){var e=t.fromView(a.start);r=t.layer().newShape("rect"),r.set(t.options),r.x(e.x),r.y(e.y)}function o(a){var e=a.distanceX/t.zoom(),n=a.distanceY/t.zoom(),o=t.fromView(a.start);if(s()){var i=Math.max(Math.abs(e),Math.abs(n));r.x(o.x+(e>0?0:-i)),r.y(o.y+(n>0?0:-i)),r.width(i),r.height(i)}else r.x(o.x+Math.min(e,0)),r.y(o.y+Math.min(n,0)),r.width(Math.abs(e)),r.height(Math.abs(n))}function i(){r&&t.save(r),r=null}var r,s=a.observable(!1);return{name:"Rectangle",iconView:'<span class="draw-icon-square"></span>',toolbarView:e,dragstart:n,drag:o,release:i,off:i,lock:s,toggleLock:function(){s(!s())}}});