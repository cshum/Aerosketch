define(["underscore","knockout","draw","util/requestanimationframe"],function(n,o,e,r){var i,t,a,s,f,u,c=function(n,o){var e=n.x-o.x,r=n.y-o.y;return e*e+r*r},d=function(n){"none"==e.options.stroke()&&e.options.stroke("black");var o=e.fromView(n.start),r=e.fromView(n.position);s=e.layer().newShape("path"),s.set(e.options),s.fill("none"),s.moveTo(o),s.lineTo(o),f=r,i=r,t=o,u=!0,a=Math.pow(e.options.strokeWidth()/2,2),l()},p=function(n){f=e.fromView(n.position)},l=function(){if(u){if(s.back(),i={x:e.round((i.x+f.x)/2),y:e.round((i.y+f.y)/2)},c(t,i)>=a){var n={x:(i.x+t.x)/2,y:(i.y+t.y)/2};s.qCurveTo(t,n),t=i}s.lineTo(i),u&&r(l)}};return{name:"Freehand",iconView:'<span class="draw-icon-freehand"></span>',dragstart:d,drag:p,release:function(){s&&e.save(s),u=!1}}});