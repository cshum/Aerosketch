define(["knockout","underscore","jquery","hammer"],function(t,e,a,r){function n(t,n){var o,i,s=n(),l=e.throttle(function(){return a(t).offset()},500),f=function(t){var e=t.type,a=t.gesture;if("release"==e)return void s("release");o={x:a.center.pageX-l().left,y:a.center.pageY-l().top},"touch"!=e&&"transformstart"!=e||(i=o);var r=o.x-i.x,n=o.y-i.y,f=a.srcEvent;s(e,{distanceX:r,distanceY:n,distance:Math.sqrt(r*r+n*n),target:a.target,shiftKey:f.shiftKey,start:i,position:o,scale:a.scale,rotation:a.rotation,angle:a.angle})},c=function(t,e){var a=t.originalEvent;s("wheel",{delta:Math.max(-.2,Math.min(.2,a.wheelDelta/3500||-a.detail/50)),position:{x:a.pageX-l().left,y:a.pageY-l().top},shiftKey:a.shiftKey,target:t.target}),t.preventDefault()};r(t,{drag_min_distance:10,prevent_default:!0,doubletap_interval:0,transform_min_scale:0,hold:!1}).on("touch tap dragstart drag transformstart transform release",f),a(t).on("mousewheel DOMMouseScroll",e.throttle(c,20))}t.bindingHandlers.surface={init:n}});