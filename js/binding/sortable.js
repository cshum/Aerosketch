define(["knockout","jquery","jquery.ui"],function(e,t){var n=function(t,n){e.utils.arrayForEach(t,function(t){1===t.nodeType&&(e.utils.domData.set(t,"ko_sortItem",n),e.utils.domData.set(t,"ko_parentList",e.utils.domData.get(t.parentNode,"ko_sortList")))})},o=function(t,o){var a,r={},s=e.utils.unwrapObservable(t());return s.data?(r[o]=s.data,r.name=s.template):r[o]=t(),e.utils.arrayForEach(["afterAdd","afterRender","beforeRemove","includeDestroyed","templateEngine","templateOptions"],function(t){r[t]=s[t]||e.bindingHandlers.sortable[t]}),"foreach"===o&&(r.afterRender?(a=r.afterRender,r.afterRender=function(e,t){n.call(t,e,t),a.call(t,e,t)}):r.afterRender=n),r};e.bindingHandlers.sortable={init:function(n,a,r,s,i){var l,d,u=t(n),c=e.utils.unwrapObservable(a())||{},p=o(a,"foreach"),b={};return e.utils.arrayForEach(n.childNodes,function(e){e&&3===e.nodeType&&e.parentNode.removeChild(e)}),t.extend(!0,b,e.bindingHandlers.sortable),c.options&&b.options&&(e.utils.extend(b.options,c.options),delete c.options),e.utils.extend(b,c),b.connectClass&&(e.isObservable(b.allowDrop)||"function"==typeof b.allowDrop)?e.computed({read:function(){var t=e.utils.unwrapObservable(b.allowDrop),o="function"==typeof t?t.call(this,p.foreach):t;e.utils.toggleDomNodeCssClass(n,b.connectClass,o)},disposeWhenNodeIsRemoved:n},this):e.utils.toggleDomNodeCssClass(n,b.connectClass,b.allowDrop),e.bindingHandlers.template.init(n,function(){return p},r,s,i),l=b.options.start,d=b.options.update,setTimeout(function(){var o;u.sortable(e.utils.extend(b.options,{start:function(e,t){t.item.find("input:focus").change(),l&&l.apply(this,arguments)},receive:function(t,n){(o=e.utils.domData.get(n.item[0],"ko_dragItem"))&&o.clone&&(o=o.clone())},update:function(n,a){var r,s,i,l,u,c,f=a.item[0],m=e.utils.domData.get(f,"ko_sortItem")||o;if(o=null,m){if(r=e.utils.domData.get(f,"ko_parentList"),s=e.utils.domData.get(f.parentNode,"ko_sortList"),i=e.utils.arrayIndexOf(a.item.parent().children(),f),!p.includeDestroyed)for(u=s(),l=0;l<i;l++)u[l]&&u[l]._destroy&&i++;if((b.beforeMove||b.afterMove)&&(c={item:m,sourceParent:r,sourceParentNode:r&&f.parentNode,sourceIndex:r&&r.indexOf(m),targetParent:s,targetIndex:i,cancelDrop:!1}),b.beforeMove&&(b.beforeMove.call(this,c,n,a),c.cancelDrop))return void(c.sourceParent?t(c.sourceParent===c.targetParent?this:a.sender).sortable("cancel"):t(f).remove());i>=0&&(r&&r.remove(m),s.splice(i,0,m)),e.utils.domData.set(f,"ko_sortItem",null),a.item.remove(),b.afterMove&&b.afterMove.call(this,c,n,a)}d&&d.apply(this,arguments)},connectWith:!!b.connectClass&&"."+b.connectClass})),void 0!==b.isEnabled&&e.computed({read:function(){u.sortable(e.utils.unwrapObservable(b.isEnabled)?"enable":"disable")},disposeWhenNodeIsRemoved:n})},0),e.utils.domNodeDisposal.addDisposeCallback(n,function(){u.sortable("destroy")}),{controlsDescendantBindings:!0}},update:function(t,n,a,r,s){var i=o(n,"foreach");e.utils.domData.set(t,"ko_sortList",i.foreach),e.bindingHandlers.template.update(t,function(){return i},a,r,s)},connectClass:"ko_container",allowDrop:!0,afterMove:null,beforeMove:null,options:{}},e.bindingHandlers.draggable={init:function(n,a,r,s,i){var l=e.utils.unwrapObservable(a())||{},d=l.options||{},u=e.utils.extend({},e.bindingHandlers.draggable.options),c=o(a,"data"),p=l.connectClass||e.bindingHandlers.draggable.connectClass,b=void 0!==l.isEnabled?l.isEnabled:e.bindingHandlers.draggable.isEnabled;return l=l.data||l,e.utils.domData.set(n,"ko_dragItem",l),e.utils.extend(u,d),u.connectToSortable=!!p&&"."+p,t(n).draggable(u),void 0!==b&&e.computed({read:function(){t(n).draggable(e.utils.unwrapObservable(b)?"enable":"disable")},disposeWhenNodeIsRemoved:n}),e.bindingHandlers.template.init(n,function(){return c},r,s,i)},update:function(t,n,a,r,s){var i=o(n,"data");return e.bindingHandlers.template.update(t,function(){return i},a,r,s)},connectClass:e.bindingHandlers.sortable.connectClass,options:{helper:"clone"}}});